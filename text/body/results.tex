% \section{Results}
\input{fig/dynamics}

\section{On-device Data Management}
\label{sec:dynamics}

Transient dynamics
% While this scheme allowed maximization of on-device resources, as a consequence the set of sampled time points varied depending on how long nonmutator alleles persisted.
% As a result, the number of generations elapsed per frame in provided animations varies.

To assess how competition between non- and mutator strains unfolds at very large population scales, we performed an additional set of simulations on the WSE using the site-explicit model of adaptation, where mutators originated \textit{de novo} from nonmutator strains.
% For these experiments, a subpopulation size of 256 agents per PE was used to preserve on-device memory to record time series data.
% This configuration yielded a net population size of 191 million agents.
% In these trials, we probed the critical region where outcomes transition between nonmutator and mutator fixation, configuring adaptive potential between 12 and 16 available beneficial mutations.

This experiment additional runtime data logging in our simulations to track time series data of mutator allele prevalence.
Working within the limited per-PE memory capacity of XXkb, however, required careful consideration. TODO
Generation-on-generation, we configured each processor element to sample a genome from its local population and record its mutator allele status (i.e., a binary value as either a non- or mutator).
To efficiently curate this single-bit data within per-PE memory limits while allowing a flexible recording duration (as timing of extinction or fixation events is not known \textit{a priori}), we leveraged recently introduced ``DStream'' ring buffer data structures \citep{moreno2024algorithms}.
Notably, this approach constrained memory use to a fixed-size buffer, while allowing recording to be dynamically halted when nonmutators were determined to be locally extinct (and restarted if they are reintroduced).

Figure \ref{fig:dynamics} arranges sequential population snapshots from two example simulations, both with adaptive potential of 14 beneficial mutations.
In the first example, mutators fixed; in the second, they did not.
At outset, panels \ref{fig:dynamics:no-fixation} and \ref{fig:dynamics:fixation} unfold similarly.
First, mutator strains appear \textit{de novo} across the breadth of simulated populations.
Then, as patches of mutators expand outwards, the nonmutator population is broken into pockets.
% Mutator strains continued to stem from nonmutator lineages as they accrued adaptive mutations.
% Of 16 replicates where we observed mutators fix, we found 2 cases where the final dominant mutator lineage arose from a partially adapted nonmutator lineage --- harboring 1 and 3 beneficial mutations, respectively.
% https://github.com/mmore500/hypermutator-dynamics/blob/90422b30f2dd9ca29baad273cbcc676dbfeab55f/binder/wse-denovo-spatial2d-explicitsite-genomes.ipynb
In scenarios where mutators fix, surviving patches of nonmutators dwindle away entirely (panel \ref{fig:dynamics:fixation}).
Where nonmutators persist, they re-establish via concentric growth from surviving pockets (panel \ref{fig:dynamics:no-fixation}).
This TODO allowed us to assess the fact that mutators transiently peak at well above the majority of population composition.
% \input{fig/peaksweep}
In fact, at peak mutator prevalence, we observed nonmutators shrink to less than 0.1\% of the population in experiments with adaptive potential of 14 available beneficial mutations.

\section{Simulation Performance}
\label{sec:performance}

\input{fig/perf}

To assess the efficacy of hardware accelerator resources in expediting our simulations, we collected timings of runtime duration from our simulation experiments.
As a baseline comparison point for performance, we also benchmarked simulation on CPU.


Mean throughput was 7.0 (SD 0.5) million AGPS on CPU, 2.7 (SD 0.03) billion AGPS on GPU, and 780 (SD 0.5) billion AGPS on WSE for \textit{de novo} trials using the counter-based model.
Figure \ref{fig:perf} compares simulation performance between hardware platforms, measured in agent-generations per second (AGPS).
% Net speedup, normalized to mean CPU throughput, was $378\times$ (SD 4) on GPU and $111,091\times$ (SD 75) on WSE.
Normalized to net GPU performance, WSE provided a speedup of $294\times$ (SD 0.2).

% Under the site-explicit model, WSE gave 650 (SD 50) billion AGPS under \textit{de novo} conditions.
% The site-explicit model was not implemented on GPU.
% For all the above, 50/50 trials gave similar performance to \textit{de novo}.

On WSE, we found agent-generation throughput to be consistent across per-PE population densities.
%, as shown in Supplementary Figure \ref{fig:perf-tilepop}.
In contrast, on GPU we encountered an apparent memory-wall effect where mean  throughput dropped $>95\%$ to 121 million AGPS when increasing net population size from 15.1 million to 175 million.
% For this reason, we only scaled GPU experiments up to 15.1-million-agent populations ($243 \times 243$ demes).

% \subsection{Major Results}

% In our initial experiment, we confirmed that large populations favor mutator fixation, under the assumption of unlimited adaptive potential.
% Consistent with expectations, we found that restricting adaptive potential by capping available adaptive mutations reversed outcomes in large populations to favor nonmutators.
% Investigating the influence of population structure and composition, we found spatial structure to substantially increase the amount of adaptive potential required to fix mutator alleles in large populations.
% However, this effect only occurred when mutator alleles were initially rare within the population.
% We also report qualitative differences between effects of population size on mutator fixation probability under well-mixed versus 2D population structure when mutations are rare.
% In the final part of our investigation, we analyze the spatiotemporal dynamics of our simulations to better understand the mechanisms at play behind these effects.

% Differing from existing results, we find that in the situation of limited adaptive potential, the effect of population structure on fixation probability is actually opposite to that predicted under the theory.
% Population structure has also been found to influence mutator outcomes, with deviation from well-mixed conditions being linked to a higher probability for hypermutator fixation so long as any connectivity remains between subpopulations \citep{raynes2019migration}.


% \section{Results and Discussion} \label{sec:results}

% In this work, we investigate the interactions between population size, adaptive potential, and population structure in influencing selection on mutator traits within asexual populations.
% In our first experiments, we replicate previous work by \citet{raynes2018sign} showing sign-change effects of population size on mutator favorability.
% Subsequent experiments investigate how these dynamics vary based on initial mutator abundance and the availability of beneficial mutations.
% Finally, experiments compare mutator dynamics between well-mixed population structure and spatial segregation into subpopulations connected by migration.

% \subsection{Scaling Population Size}
% \label{sec:scaling-population-size}

% In a first set of experiments, we tested the capability of our model to reproduce the qualitative regimes of mutator dynamics across population scales identified by \citet{raynes2018sign}.
% In the first regime, where population size is very small, fixation of mutator and nonmutator alleles is nearly equiprobable, owing to the overwhelming influence of stochastic effects.
% Subsequently, in medium-sized populations, mutators become disfavored on account of increased power of selection becoming in penalizing the increased mutational load imposed by mutator allelees.
% Finally, in sufficiently large populations, a sign-change fitness effect occurs and mutator fixation becomes overwhelmingly favored.
% This effect occurs in asexual populations because population size increases the probability of at least one mutator discovering a beneficial mutation, and so ``hitch-hiking'' to sweep out nonmutators.

% \input{fig/wse-inf-one}

% As shown in the left panel of Figure \ref{fig:wse-inf-one:32}, our simulations reproduce the sign-change fitness effect described by \citet{raynes2018sign}.
% Leveraging the capabilities of WSE accelerator hardware, we tested population sizes several orders of magnitude beyond those reported in \citet{raynes2018sign}.
% For these experiments, 2D population structure was used with 50/50 initialization.
% In line with expectations, no further qualitative differences in mutator fixation probability emerged in these larger population sizes, which ranged up to 1 billion agents.
% For the largest-scale trials, shown in the left panel of Figure \ref{fig:wse-inf-one:2048}, an increased subpopulation size of 2,048 agents per deme was used.
% As such, in these trials, note that coarsened spacing between surveyed population sizes obscures the sign-change fitness effect near the lower bound of population size.

% \subsection{Restricting Adaptive Potential}
% \label{sec:restricting-adaptive-potential}

% \subsection{Major Results}

% \input{fig/avail-ben-muts-gen}

% Given that experiments conducted on the WSE platform all involve 2D spatial structure, we implemented an additional set of GPU-based experiments to compare findings with well-mixed population structure.
% Figure \ref{fig:avail-ben-muts-gen} overviews these results.
% Although experiments ranged up to a smaller maximum population size on the GPU platform, detected regimes of mutator dynamics are consistent with WSE-based experiments.
% Comparing on the basis of spatial structure, we find fixation probabilities to be near-identical between GPU-based trials using 2D and well-mixed structure across surveyed conditions.
% % https://github.com/mmore500/hypermutator-dynamics/blob/484ac79f35baf10e4acc52babee836d10ab50bdb/binder/cupy-5050-traits.ipynb
% We find significant divergence in fixation probability between spatial structure treatments only for population size 20,736 with adaptive potential of one available beneficial mutation (Mann-Whitney U test; $p < 0.0005$; Bonferroni corrected $p < 0.01$).

% \subsection{Effects of Background Mutator Prevalence}
% \label{sec:background-hypermutator-prevalence}

% \input{fig/denovo-5050-conditions-combined}

% Having observed large population size prevent mutator fixation in competition experiments under conditions of limited adaptive potential, we next sought to assess how such an effect might manifest in more naturalistic conditions.
% For this purpose, we relaxed the initial condition that mutators begin ``50/50'' in equal proportion to nonmutators.
% Instead, we allowed mutators to enter the population at a low background rate \citep{desai2011balance,johnson1999approach}, an experimental design common with several previous simulation studies of hypermutator dynamics \citep{wylie2009fixation,tenaillon1999mutators}.
% To provide a conservative reflection of the impact of mutator allele rarity, we used a mutator allele introduction probability of $10^{-6}$ per replication event.
% Figure \ref{fig:denovo-5050-conditions-combined} compares mutator fixation probabilities between 50/50 and \textit{de novo} conditions.
% Trials were conducted with 2D spatial structure on the WSE platform.
% With 256 agents per deme, population size scaled up to 136 million agents.

% Prior work analyzing conditions with infinite adaptive potential has shown per-capita favorability of mutator traits to be density independent \citep{raynes2019selection}.
% As such, a lower background rate for mutator alleles should be expected to substantially reduce the net probability of mutator fixation.
% In line with expectations, the \textit{de novo} treatment substantially reduces mutator fixation.
% Under \textit{de novo} conditions, nonmutators reliably resist mutator fixation in populations of 136 million through more than 10 beneficial mutations available.
% Under 50/50 conditions, by contrast, mutators begin to fix in these large populations past 2 beneficial mutations available.

% We performed sensitivity analysis of our findings to the underlying counter-based genome model used.
% For this purpose, we implemented an alternate ``site-explicit'' model where the probability of discovering a beneficial mutation scales proportional to the number available.
% As shown in Supplementary Figure \ref{fig:wse-site-explicit-counter-based}, results were generally consistent between the two genome models.
% Notably, though, under the ``site-explicit'' model, mutator alleles are more frequently fixed within the smallest surveyed population size under 50/50 initialization.

% % ^^^ https://github.com/mmore500/hypermutator-dynamics/blob/5e904ac2fbbd4b41a0ad679883fc1a63af71c00c/binder/wse-denovo-spatial2d-explicitsite-timeseries.ipynb
% To assess the magnitude of transient peak mutator concentrations across levels of adaptive potential, we performed an additional set of four-replicate simulations with adaptive potentials ranging from 2 to 10 available beneficial mutations.
% For all replicates with 6 or more available beneficial mutations, mutators peaked beyond 50\% prevalence (Figure \ref{fig:peaksweep}).

% \subsection{Effects of Population Structure}
% \label{sec:population-structure}

% In a final set of experiments, we extended our earlier trials with 50/50 initialization to assess the impact of spatial structure on mutator dynamics where mutators are initially rare.
% In particular, we were curious whether removal of population structure would negligibly affect mutator fixation probabilities, as was earlier the case with 50/50 initialization.
% Trials conducted in this experiment comparing the 2D deme structure to fully well-mixed conditions were conducted using GPU evaluation.
% As a result, population sizes ranged only up to 15 million.

% \input{fig/spatial-structure-combined}

% Figure \ref{fig:spatial-structure-combined} plots increase in mutator fixation probability with available adaptive potential across a spectrum of population sizes.
% Interestingly, spatial structure does cause results to differ substantially under \textit{de novo} conditions.
% We find that in large nonmutator populations of 15 million with well-mixed structure, fixation probability of mutator alleles becomes appreciable with adaptive potential of only 5 available beneficial mutations.
% Thisis not the case for large populations with 2D deme structure, where fixation of mutator alleles become appreciable above 10 available beneficial mutations.
% For intermediate population sizes of 186,000 agents, however, an opposite effect occurs: spatial structure raises the probability of mutator fixation across the board of available adaptive potential compared to well-mixed conditions.

% These findings contrast with previous modeling work assuming unlimited adaptive potential, which predicts that so long as any level of connectivity exists between subpopulations, spatial structure boosts mutator fixation probability \citep{raynes2019migration}.
% One possible explanation for why spatial structure can decrease mutator fixation probability is in extending fixation times, which extends the opportunity for nonmutators to exploit available adaptive potential before being driven to extinction.
% This described effect notably aligns with findings from \textit{in vivo} evolution experiments with \textit{E. coli} that show that migration barriers delaying introduction of mutator strains into nonmutator populations can reduce mutator advantage \citep{lechat2006escherichia}.

% On a separate front, it is surprising that substantial differences in mutator dynamics between deme-structured and well-mixed conditions only become apparent with low initial mutator frequency, given the established expectation of fitness effects of mutator alleles as a density- and number- independent \citep{raynes2019selection}.
% While one possible explanation may be in part that detectability of fitness effect magnitudes is masked by sensitivity limitations of the 50/50 assay, this result draws into question the extent to which density-independence of mutator fitness effects generalizes to scenarios with limited adaptive potential and spatial structure.
% In future work, it would be informative to test whether the impact of spatial structure where mutators are rare stems from heterogeneity in the spatial distribution of mutator clades or from slowing the spread of beneficial alleles.
